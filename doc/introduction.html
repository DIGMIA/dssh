<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.4.4" />
<title>Digmia Secure Shell Introduction manual</title>
<style type="text/css">
/* Debug borders */
p, li, dt, dd, div, pre, h1, h2, h3, h4, h5, h6 {
/*
  border: 1px solid red;
*/
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

tt {
  color: navy;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  font-family: sans-serif;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}

div.sectionbody {
  font-family: serif;
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}

pre {
  padding: 0;
  margin: 0;
}

span#author {
  color: #527bbd;
  font-family: sans-serif;
  font-weight: bold;
  font-size: 1.1em;
}
span#email {
}
span#revision {
  font-family: sans-serif;
}

div#footer {
  font-family: sans-serif;
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
div#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
div#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

div#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.tableblock, div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.5em;
  margin-bottom: 2.5em;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-family: sans-serif;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid silver;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid silver;
  background: #f4f4f4;
  padding: 0.5em;
}

div.quoteblock {
  padding-left: 2.0em;
  margin-right: 10%;
}
div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock {
  padding-left: 2.0em;
  margin-right: 10%;
}
div.verseblock > div.content {
  white-space: pre;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 2px solid silver;
}

div.exampleblock > div.content {
  border-left: 2px solid silver;
  padding: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
div.imageblock img { border: 1px solid silver; }
span.image img { border-style: none; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

div.tableblock > table {
  border: 3px solid #527bbd;
}
thead {
  font-family: sans-serif;
  font-weight: bold;
}
tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

@media print {
  div#footer-badges { display: none; }
}

div#toctitle {
  color: #527bbd;
  font-family: sans-serif;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}
/* Workarounds for IE6's broken and incomplete CSS2. */

div.sidebar-content {
  background: #ffffee;
  border: 1px solid silver;
  padding: 0.5em;
}
div.sidebar-title, div.image-title {
  color: #527bbd;
  font-family: sans-serif;
  font-weight: bold;
  margin-top: 0.0em;
  margin-bottom: 0.5em;
}

div.listingblock div.content {
  border: 1px solid silver;
  background: #f4f4f4;
  padding: 0.5em;
}

div.quoteblock-attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock-content {
  white-space: pre;
}
div.verseblock-attribution {
  padding-top: 0.75em;
  text-align: left;
}

div.exampleblock-content {
  border-left: 2px solid silver;
  padding-left: 0.5em;
}

/* IE6 sets dynamically generated links as visited. */
div#toc a:visited { color: blue; }
</style>
</head>
<body>
<div id="header">
<h1>Digmia Secure Shell Introduction manual</h1>
<span id="author">Juraj Bednar</span><br />
<span id="email"><tt>&lt;<a href="mailto:juraj.bednar@digmia.com">juraj.bednar@digmia.com</a>&gt;</tt></span><br />
<span id="revision">version 1.1x,</span>
01.02.2010
</div>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph"><p>This document is an introduction to Digmia Secure Shell (DSSH for short). DSSH was
written as a direct replacement for OpenSSH client for our use. DSSH adds SSH over
SSH tunelling capabilities (for example to log in to network hidden by
firewall), scripting support (using Groovy), advanced agent (which allows storing
of passwords) and "su -" interactive logging for machines, which have disabled
direct root login.</p></div>
<div class="paragraph"><p>All of this was done to enable automated scripting and logging to lots of machines
based on few simple rules.</p></div>
<div class="paragraph"><p>It uses trilead SSH library (slightly patched).</p></div>
</div>
</div>
<h2 id="_requirements">Requirements</h2>
<div class="sectionbody">
<div class="paragraph"><p>DSSH requires:</p></div>
<div class="ulist"><ul>
<li>
<p>
a terminal emulator (Windows command prompt will not work for this purpose,
   so only UNIX-like systems are currently supported)
</p>
</li>
<li>
<p>
Java runtime environment (at least 6.0)
</p>
</li>
</ul></div>
<div class="paragraph"><p>Supported platforms (out of the box):</p></div>
<div class="ulist"><ul>
<li>
<p>
Mac OS X on x86, x86_64 and PPC
</p>
</li>
<li>
<p>
Linux on x86 and amd64
</p>
</li>
<li>
<p>
FreeBSD 7
</p>
</li>
<li>
<p>
Solaris 10
</p>
</li>
</ul></div>
</div>
<h2 id="_installation">Installation</h2>
<div class="sectionbody">
<div class="paragraph"><p>First of all, you must have Java Runtime Environment (at least 6.0) already installed.
If you have one of the supported platforms, you can download binary tarball, untar it
and from the dssh-VERSION directory run:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>./scripts/install.sh /usr/local/lib/dssh</tt></pre>
</div></div>
<div class="paragraph"><p>(/usr/local/lib/dssh can be obviously changed to a different directory). The install
script will create /etc/dssh/dssh.opts, which you can examine (you at least need to
correct path to java binary).</p></div>
<div class="paragraph"><p>It will also tell you to create symbolic links or add /usr/local/lib/dssh/scripts to
your path.</p></div>
<div class="paragraph"><p>You can test your installation by running</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>dssh username@server</tt></pre>
</div></div>
<div class="paragraph"><p>and see if you get in.</p></div>
</div>
<h2 id="_compilation">Compilation</h2>
<div class="sectionbody">
<div class="paragraph"><p>In case you want to recompile DSSH, you need to grab source distribution. Easiest
way to recompile is to use NetBeans.</p></div>
<div class="paragraph"><p>In jniconsole directory are some C++ binaries, which can be slightly modified to
compile under different UNIX-like systems (it uses only POSIX calls, but includes
will probably need to be corrected for each OS). Please contribute your changes back.</p></div>
</div>
<h2 id="_dssh_command_suite">DSSH command suite</h2>
<div class="sectionbody">
<div class="paragraph"><p>DSSH consists of several commands.</p></div>
<h3 id="_dssh">dssh</h3><div style="clear:left"></div>
<div class="paragraph"><p>This is the basic command. You can see it&#8217;s full help by calling dssh -h. Basically,
it should work similiary to OpenSSH client.</p></div>
<div class="paragraph"><p>It uses a few environment variables:</p></div>
<div class="ulist"><ul>
<li>
<p>
DSSHSCRIPTNAME - path to the bsh script name. If not specified (and there&#8217;s
  no -g command line option), dssh looks for file ~/.dssh/dssh.bsh and dssh.bsh
  in current directory (in this order).
</p>
</li>
<li>
<p>
DSSHAGENT - location of dssh agent (see below). Same as specifying -a option (which
  takes precedence).
</p>
</li>
</ul></div>
<h3 id="_dssh_agent">dssh-agent</h3><div style="clear:left"></div>
<div class="paragraph"><p>dssh-agent is a simple credidentals storage similiar to ssh-agent. It allows for
storage of plaintext password in addition to private keys. This is useful if you want
to authenticate as root to a server, which has disabled PermitRootLogin.</p></div>
<div class="paragraph"><p>dssh and dssh-agent communicate through SSL-protected channel. You need to create
a keypair, so dssh and dssh-agent would recognize (and trust) each other. Full SSL
authentication/encryption is possible, but in most simple cases, you just pair dssh
and dssh-agent using a keypair, that is shared between these programs. To do this,
run dssh-create-keystore script included with distribution.</p></div>
<div class="paragraph"><p>Then you can run dssh-agent like this:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>dssh-agent 1234 &amp;</tt></pre>
</div></div>
<div class="paragraph"><p>where 1234 is a port, on which agent listens.</p></div>
<h3 id="_dssh_add">dssh-add</h3><div style="clear:left"></div>
<div class="paragraph"><p>Similiary to ssh-add, dssh-add allows adding passwords and private keys to dssh-agent&#8217;s
key store. We recommend setting DSSHAGENT variable like this:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>export DSSHAGENT=1234</tt></pre>
</div></div>
<div class="paragraph"><p>This will ease your life, as you don&#8217;t have to specify -a options to dssh or dssh-add every time.
Adding private key is easy:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>dssh-add -i ~/.ssh/id_dsa</tt></pre>
</div></div>
<div class="paragraph"><p>Will add ~/.ssh/id_dsa key, asking for passphrase if necessary.</p></div>
<div class="paragraph"><p>You can load a file in CSV format, which contains passwords and has the following structure:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>server1.digmia.com;22;root;dorka;www-server1.digmia.com
server2.digmia.com;22;root;dorka;www-server2.digmia.com;www-server3.digmia.com</tt></pre>
</div></div>
<div class="paragraph"><p>First column is server name, second column is port, third column is username,
fourth column is password and any additional columns are optional and are aliases
for the machine. If you have several entries for one machine, you need to specify
aliases only once.</p></div>
<div class="paragraph"><p>We recommend keeping this file on disk encrypted and loading it for example like this:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>gpg --decrypt dssh-passwords.csv.gpg | dssh -l</tt></pre>
</div></div>
</div>
<h2 id="_scripting">Scripting</h2>
<div class="sectionbody">
<div class="paragraph"><p>One of the strengths of dssh is BeanShell scripting support. Default script name is ~/.dssh/dssh.bsh.</p></div>
<div class="paragraph"><p>Script should implement one class, that implements SSHConnectionCreator interface. It basically
requires three methods:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>public void setVerbose(boolean verbose);
public SSHConnection getAuthenticatedSSHConnection(String username, String host, int port, SSHConnection
             par, SSHAuthenticator auth);
public InteractiveSession getInteractiveSession(SSHConnection conn, String username, PasswordAuthenticator pass, String host) {</tt></pre>
</div></div>
<div class="paragraph"><p>setVerbose is called by DSSH to inform your script if it should be verbose or not (passing true
when dssh is called with -v). You can either ignore this call (having the method empty) or
remember it for further use later.</p></div>
<div class="paragraph"><p>getAuthenticatedSSHConnection is called when dssh wants to connect to a particular server. It
should return authenticated SSH connection without creating session. This connection can either
be used for creating port forwards, interactive sessions or copying files (not yet implemented).
Cascading through tunnels is implemented here.</p></div>
<div class="paragraph"><p>Finally, when user wants to enter interactive session, getInteractiveSession is called, which
should return an InteractiveSession or it&#8217;s subclass (currently, InteractiveSuSession is
implemented).</p></div>
<div class="paragraph"><p>To best understand how scripts work, I am including a fairly advanced and well-commented example
in documentation directory.</p></div>
</div>
<h2 id="_history_and_copyright">History and copyright</h2>
<div class="sectionbody">
<div class="paragraph"><p>DSSH is (c) Juraj Bednar, Digmia s.r.o. and can be redistributed and used under
conditions of GPLv2.</p></div>
<div class="paragraph"><p>It uses Trilead-SSH, which has the following license:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>The Trilead SSH for Java library is released under a BSD style license.</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>Copyright (c) 2007 Trilead AG (http://www.trilead.com)</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>All rights reserved.</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions
are met:</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>a.) Redistributions of source code must retain the above copyright
    notice, this list of conditions and the following disclaimer.
b.) Redistributions in binary form must reproduce the above copyright
    notice, this list of conditions and the following disclaimer in the
    documentation and/or other materials provided with the distribution.
c.) Neither the name of Trilead nor the names of its contributors may
    be used to endorse or promote products derived from this software
    without specific prior written permission.</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
POSSIBILITY OF SUCH DAMAGE.</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>Trilead SSH-2 for Java includes code that was written by Dr. Christian Plattner
during his PhD at ETH Zurich. The license states the following:</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>Copyright (c) 2005 - 2006 Swiss Federal Institute of Technology (ETH Zurich),
  Department of Computer Science (http://www.inf.ethz.ch),
  Christian Plattner. All rights reserved.</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions
are met:</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>a.) Redistributions of source code must retain the above copyright
    notice, this list of conditions and the following disclaimer.
b.) Redistributions in binary form must reproduce the above copyright
    notice, this list of conditions and the following disclaimer in the
    documentation and/or other materials provided with the distribution.
c.) Neither the name of ETH Zurich nor the names of its contributors may
    be used to endorse or promote products derived from this software
    without specific prior written permission.</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
POSSIBILITY OF SUCH DAMAGE.</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>The Java implementations of the AES, Blowfish and 3DES ciphers have been
taken (and slightly modified) from the cryptography package released by
"The Legion Of The Bouncy Castle".</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>Their license states the following:</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>Copyright (c) 2000 - 2004 The Legion Of The Bouncy Castle
(http://www.bouncycastle.org)</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.</tt></pre>
</div></div>
<div class="paragraph"><p>SSH is a registered trademark of SSH Communications Security Corp
in the United States and in certain other jurisdictions. Java and
J2ME are trademarks or registered trademarks of Sun Microsystems,
Inc. in the United States and other countries. All other names and
marks are property of their respective owners.</p></div>
<div class="paragraph"><p>It also uses OpenCSV, which is under Apache 2 license (<a href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a>).</p></div>
<div class="paragraph"><p>GNU GetOpt is under LGPL license (<a href="http://www.gnu.org/copyleft/library.html">http://www.gnu.org/copyleft/library.html</a>)</p></div>
</div>
<div id="footer">
<div id="footer-text">
Version 1.1x<br />
Last updated 2010-02-01 17:48:54 MEST
</div>
</div>
</body>
</html>
